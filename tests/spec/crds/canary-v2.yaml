apiVersion: iter8.ibm.com/v1alpha1
kind: Canary
metadata:
  name: reviews
  namespace: default
spec:
  targetService: reviews # required; targetService is an object ref rather than a name; # knative sink
  trafficControl:
    strategy: "check_and_increment" # required;
    maxTrafficPercent: 50.0 #optional; default = 50.0
    stepSize: 2.0 #optional; default = 2.0
    analyticsEndPoint: http://iter8analytics/analytics/canary
    interval: 1m # optional; 1 min default;
    experimentDeadline: 30m # optional; 30 min default;
    metrics:
    - name: iter8_mean_latency
      succeedOn:
        delta: 0.1 # relative threshold; baseline should have at most 10% latency increase
        failureTolerance: 10 # optional; default = 10
    - name: iter8_stddev_latency
      succeedOn:
        delta: 0.5 # relative threshold; baseline should have at most 10% latency increase
        failureTolerance: 10 # optional; default = 10
    - name: iter8_error_rate
      succeedOn:
        threshold: 0.02 # absolute threshold; 2%
        failureTolerance: 3 # optional; default = 10
    - name: iter8_error_count
      succeedOn:
        threshold: 20 # absolute threshold; 2%
        failureTolerance: 0 # optional; default = 10
