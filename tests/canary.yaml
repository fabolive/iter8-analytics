kind: Canary
metadata:
  name: reviews
  namespace: default
spec:
  #if you have more than one revision running currently, experiment cannot proceed
  targetService: reviews # required
  experimentNow: True # default True
  canaryRevision: reviews-v3 # optional; if this is not specified, canary = latest
  analysis:
    analyticsService: http://iter8analytics
    type: canary # other type is AB
    maxTraffic: 5 # in percentage; since this is less than 100, its a canaryTest (not a complete rollout)
    interval: 1m
    experimentDeadline: 20m # optional
    warmupRequestCount: 100 # optional
    metrics:
    - name: iter8_latency
      succeedOn:
        delta: 0.1 # 10% increase in latency is ok with me
        confidence: 98
      stopOn: # optional
        threshold: 1.2s
        minRequests: 75 # optional
    - name: iter8_error_rate
      succeedOn:
        threshold: 0.02
        confidence: 99.9
    - name: iter8_error_count
      stopOn:
        threshold: 20
    onSuccess: canary # baseline, both
